<div class="relative flex flex-auto w-full bg-card dark:bg-transparent">
    <!-- Chats list -->
    <ng-container>
        <div
            class="relative flex flex-auto flex-col w-full min-w-0 md:min-w-60 md:max-w-60 bg-card dark:bg-transparent">

            <!-- Header -->
            <div class="flex flex-col flex-0 py-4 px-4 border-b bg-gray-50 dark:bg-transparent">
                <div class="flex items-center cursor-pointer" (click)="openNewChat()">
                    <mat-icon [svgIcon]="'heroicons_outline:plus-circle'"></mat-icon>
                    <div class="ml-4 font-medium">Tin nhắn mới</div>
                </div>
                <!-- Search -->
                <ng-container>
                    <div class="mt-4">
                        <mat-form-field class="fuse-mat-rounded fuse-mat-dense w-full">
                            <mat-icon
                                matPrefix
                                class="icon-size-5"
                                [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
                                <input
                                    matInput
                                    [autocomplete]="'off'"
                                    [placeholder]="'Tìm kiếm đoạn chat'"
                                    (input)="filterChats(searchField.value)"
                                    #searchField>
                        </mat-form-field>
                    </div>
                </ng-container>
            </div>

            <!-- Chats -->
            <div class="flex-auto overflow-y-auto h-[calc(100vh-250px)]">
                <ng-container *ngIf="filteredChats.length > 0; else noChats">
                    <ng-container *ngFor="let chat of filteredChats; trackBy: trackByFn">
                        <div class="z-20 flex items-center py-4 px-4 cursor-pointer border-b"  (click)="selectedChatSession(chat)"
                            [ngClass]="{'hover:bg-gray-100 dark:hover:bg-hover': !selectedChat || selectedChat.id !== chat.id,
                                        'bg-primary-50 dark:bg-hover': selectedChat && selectedChat.id === chat.id}" [routerLink]="[chat.id]">

                            <div class="min-w-0">
                                <div class="font-medium leading-5 truncate">{{chat.title}}</div>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>
                <!-- No chats template -->
                <ng-template #noChats>
                    <div class="flex flex-auto flex-col items-center justify-center h-full">
                        <mat-icon class="icon-size-24" [svgIcon]="'heroicons_outline:chat-bubble-oval-left-ellipsis'"></mat-icon>
                        <div class="mt-4 text-2xl font-semibold tracking-tight text-secondary">Chưa có đoạn chat nào</div>
                    </div>
                </ng-template>
            </div>

        </div>

    </ng-container>

    <ng-container *ngIf="chat_session && chat_session.length > 0">
        <div
            class="flex-auto border-l"
            [ngClass]="{'z-20 absolute inset-0 md:static md:inset-auto flex': selectedChat && selectedChat.id,
                        'hidden md:flex': !selectedChat || !selectedChat.id}">
                <router-outlet></router-outlet>
            </div>
    </ng-container>
    <!-- Ensure empty-message route can render when there are no chats -->
    <ng-container *ngIf="!chat_session || chat_session.length === 0">
        <div class="flex-auto border-l md:flex">
            <router-outlet></router-outlet>
        </div>
    </ng-container>
</div>